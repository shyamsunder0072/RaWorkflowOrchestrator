{% extends "airflow/master.html" %}
{% block title %}
{{ title }}
{% endblock %}

{% block head_js %}
{{ super() }}
<script type="text/javascript">

    if ( window.history.replaceState ) {
      window.history.replaceState( null, null, window.location.href );
    }
    
  </script>

{% endblock %}

{% block head_css %}
{{ super() }}

<style>
</style>

{% endblock %}


{% block content %}
{{ super() }}


<body>
<div class="container">
  <h2>{{title}} - {{group}} </h2><br>
  <form action="", method="post" >
    <div class="row">
      <div class="col-xs-3">
        <div >
          <input  name="_csrf_token" type="hidden" value="{{ csrf_token() }}">
          <h3>Arguments</h3>
        </div>
      </div>
    </div>

    <div id="container1" >
      
      {%for i in Arguments%}
      <div >  
        {%if i == 'jars' and len_jar>0%}<!-- JARS-->
          <div class="row"><!-- row1 begin --> 
            <div class="col-xs-3"> <!-- col1 begin -->
              <label for={{i}} >{{i}}</label>
            </div><!-- col1 end -->
            
            <div class="col-xs-8"><!-- col2 begin -->
              <div onclick="javascript:getAllNames({{Files}},'{{Arguments[i]}}',1); javascript:showCoutureCheckBoxes(); ">
                <select class="form-control">
                  <option>Click to select jar files</option>
                </select>
              </div>
              <div id="couturecheckboxes" ></div>
            </div><!-- col2  end -->
            
          </div>
          <br>
        {% elif i=='jars' and len_jar == 0%}
        <div class="row"><!-- row1 begin --> 
          <div class="col-xs-3"> <!-- col1 begin -->
            <label for={{i}} >{{i}}</label>
          </div><!-- col1 end -->
            
          <div class="col-xs-8"><!-- col2 begin -->
            No files at location.
          </div>
        </div> 
          
        <br>
        {% endif %}
        

        {%if i == 'py-files' and len_py>0%}<!-- JARS-->
          <div class="row"><!-- row1 begin --> 
            <div class="col-xs-3"> <!-- col1 begin -->
              <label for={{i}} >{{i}}</label>
            </div><!-- col1 end -->
            
            <div class="col-xs-8"><!-- col2 begin -->
              <div >
                <select class="form-control" onclick="javascript:getAllNames({{Py_Files}},'{{Arguments[i]}}',2); javascript:pyShowCoutureCheckBoxes(); ">
                  <option >Click to select python files</option>
                </select>
              </div>

              
            <div id="py_couturecheckboxes" ></div>
              
            </div><!-- col2  end -->
            
            
          </div> 
          <br>
        {% elif i=='py-files' and len_py == 0%}
        <div class="row"><!-- row1 begin --> 
          <div class="col-xs-3"> <!-- col1 begin -->
            <label for={{i}} >{{i}}</label>
          </div><!-- col1 end -->
            
          <div class="col-xs-8"><!-- col2 begin -->
            No files at location.
          </div>
        </div> 
          <br>
          
        {% endif %}

        {%if i == 'keytab' and kt_len>0%}<!-- JARS-->
          <div class="row"><!-- row1 begin --> 
            <div class="col-xs-3"> <!-- col1 begin -->
              <label for={{i}} >{{i}}</label>
            </div><!-- col1 end -->
            
            <div class="col-xs-8"><!-- col2 begin -->
              <div onclick="javascript:getAllNames({{kt_Files}},'{{Arguments[i]}}',3); javascript:ktShowCoutureCheckBoxes(); ">
                <select class="form-control">
                  <option>Click to select keytab files</option>
                </select>
              </div>
              <div id="kt_couturecheckboxes" ></div>
            </div><!-- col2  end -->
            
            
          </div> 
          <br>
        {% elif i=='keytab' and kt_len == 0%}
        <div class="row"><!-- row1 begin --> 
          <div class="col-xs-3"> <!-- col1 begin -->
            <label for={{i}} >{{i}}</label>
          </div><!-- col1 end -->
            
          <div class="col-xs-8"><!-- col2 begin -->
            No files at location.
          </div>
        </div> 
          
          <br>
        {% endif %}

      

        {%if i!='jars' and i!='py-files' and i!='keytab'%}
          <div class="row"><!-- row begin -->
            
            <div class="col-xs-3">
              <label for={{i}} >{{i}}</label>
            </div>
            
            <div class="col-xs-8">
              <input class="form-control" id={{i}} name={{i}} type="text" value="{{Arguments[i]}}">
            </div>
            
            <button onclick= "javascript:delFeed('{{i}}', 'for_delete')" class="close pull-left" aria-label="Close" title="Delete Argument"> 
              <i class="glyphicon glyphicon-remove-circle" style="color:red" aria-hidden="true"></i></button>
          </div><!-- row end -->
          <br>
        {%endif%}
      </div>
      {%endfor%}


      
    </div>

    <br>
    <div class="form-group">
      
        <div >
          <a href="javascript:addFeed()" class="btn btn-success col-xs-2 col-xs-offset-9">Add In Arguments</a>
        </div>
      
    </div>
    
    
    <div class= "form-group" >
      <h3>Configurations</h3>
    </div>
    

    <div id="container2" >
      {%for j in Configurations%}
        <div class="row">
          <div class="col-xs-3">
            <label for={{j}}  >{{j}}</label>
          </div>

          <div class="col-xs-8">
            <input class="form-control" id={{j}} name={{j}} type="text" value="{{Configurations[j]}}">
          </div>

          
          <button onclick= "javascript:delFeed('{{j}}', 'for_delete_config')" class="close pull-left" aria-label="Close" title="Delete Configuration"> 
            <i class="glyphicon glyphicon-remove-circle" style="color:red" aria-hidden="true"></i></button>
        </div>
        
        <br>
      {%endfor%}
    </div>
    <br>
    
      <div >
        <a href="javascript:addFeedConfig()" class="btn btn-success col-xs-2 col-xs-offset-9">Add In Configurations</a>
      </div>
      <br>
      <div >
        <input type="submit" class="btn btn-success col-xs-1 col-xs-offset-6" value="Submit">
      </div>
    
  </form>
</div>


<div class="container" id="newfield_for_delete" style="display:none">
  <input class="form-control" name="option_title_args_delete" id="for_delete" type="hidden" placeholder="Enter name">

</div>

<div class="container" id="newfield_for_delete_config" style="display:none">
  <input class="form-control" name="option_title_config_delete" id="for_delete_config" type="hidden" placeholder="Enter name">
</div>


</body>
{% endblock %}

{% block tail_js %}
{{ super() }}
<script type="text/javascript">

const globalValues = {
  newConfigKeySN: 0,
  newArgKeySN: 0,
};

//function to add another row of fields for arguments inputs
function addFeed()
{
  var div1 = document.createElement('div');
  const template = '<div class="row">'
    + '<div class="col-xs-3">'
      + '<input class="form-control" name="new-arg-key-'+ globalValues.newArgKeySN + '" type="text" value="" placeholder="Enter key">'
      +'<br>'
    + '</div>'
    + '<div class="col-xs-8">'
    +   '<input class="form-control" name="new-arg-value-' + globalValues.newArgKeySN + '" type="text" value="" placeholder="Enter value">'
    + '</div>';
  '</div>'
  div1.innerHTML = template;
  globalValues.newArgKeySN += 1;
  document.getElementById('container1').appendChild(div1);
}

//function to add another row of fields for configurations inputs
function addFeedConfig()
{
  var div1 = document.createElement('div');
  const template = '<div class="row">'
    + '<div class="col-xs-3">'
      + '<input class="form-control" name="new-config-key-'+ globalValues.newConfigKeySN + '" type="text" value="" placeholder="Enter key">'
      +'<br>'
    + '</div>'
    
    + '<div class="col-xs-8">'
    + '<input class="form-control" name="new-config-value-' + globalValues.newConfigKeySN + '" type="text" value="" placeholder="Enter value">'
    + '</div>';
  '</div>'
  div1.innerHTML = template;
  globalValues.newConfigKeySN += 1;
  document.getElementById('container2').appendChild(div1);
}

//deletes an entire row of the field for args or configs as specified by user
function delFeed(option, element)
{
  let del = confirm("Are you sure you want to delete?");
  let update = 'newfield_for_delete';
  let container_no = 'container1';
  if(element == 'for_delete_config'){
    update += '_config';
    container_no = 'container2';
  }
  if(del) {
    document.getElementById(element).value = option;
    var div1 = document.createElement('div');
    div1.innerHTML = document.getElementById(update).innerHTML;
    document.getElementById(container_no).appendChild(div1);
  }
}

var expanded = false;
count_of_clicks=1;
var py_expanded = false;
py_count_of_clicks=1;
var kt_expanded = false;
kt_count_of_clicks=1;

//3 functions to display checkboxes of the 3 types of files - jar, py ,kt
function showCoutureCheckBoxes(f_1) {
  count_of_clicks++;
  var couturecheckboxes = document.getElementById("couturecheckboxes");

  if (!expanded) {
    couturecheckboxes.style.display = "block";
    expanded = true;
  } else {
    couturecheckboxes.style.display = "none";
    expanded = false;
  }
  if(f_1){
    couturecheckboxes.style.display = "none";
    expanded = false;
  }

}

function pyShowCoutureCheckBoxes(f_2) {
  py_count_of_clicks++;
  var py_couturecheckboxes = document.getElementById("py_couturecheckboxes");

  if (!py_expanded) {
    py_couturecheckboxes.style.display = "block";
    py_expanded = true;
  } else {
    py_couturecheckboxes.style.display = "none";
    py_expanded = false;
  }
  if(f_2){
    py_couturecheckboxes.style.display = "none";
    py_expanded = false;
  }
}


function ktShowCoutureCheckBoxes(f_3) {
  kt_count_of_clicks++;
  var kt_couturecheckboxes = document.getElementById("kt_couturecheckboxes");
  if (!kt_expanded) {
    kt_couturecheckboxes.style.display = "block";
    kt_expanded = true;
  } else {
    kt_couturecheckboxes.style.display = "none";
    kt_expanded = false;
  }
  if(f_3) {
    kt_couturecheckboxes.style.display = "none";
    kt_expanded = false;
  }
}

//function that gets the names of files and puts it onto the required labels
function getAllNames(files,selected_files,num) {
  var selected_files = selected_files.split(',');
  selected=[]
  let checkboxes = "",check_name="",check_id="";
  if(num==1){
    click_count = count_of_clicks;
    checkboxes = "couturecheckboxes";
    check_name = "check";
    check_id = "checkbox";
  }
  else if(num==2){
    click_count = py_count_of_clicks;
    checkboxes = "py_couturecheckboxes";
    check_name = "py_check";
    check_id = "py_checkbox";
  }
  else if(num==3){
    click_count = kt_count_of_clicks;
    checkboxes = "kt_couturecheckboxes";
    check_name = "kt_check";
    check_id = "kt_checkbox";
  }
  
  for(var i=0; i<selected_files.length; i++){
      y=selected_files[i];
      file_name = y.split('\\').pop().split('/').pop();
      selected[i]=file_name;
      }
  var my_div = document.getElementById(checkboxes);
  if (click_count == 1)
  {
    var checkbox = "";
    for(var t=0; t<files.length; t++) {
        file_name=files[t];
        var checkbox = document.createElement("input");
        var label = document.createElement("label");
        var in_selected = false;
        for (var i=0;i<selected.length;i++)
        {
            if(file_name == selected[i]) {
                in_selected= true;
            }
        }
        if (in_selected==true) {
            checkbox.checked = "true";
        }
        checkbox.type = "checkbox";
        checkbox.value = file_name;
        checkbox.name = check_name;
        checkbox.id = check_id;
        checkbox.onclick = "javascript:showValue()";
        label.for = file_name;
        my_div.appendChild(label);
        label.appendChild(checkbox);
        linebreak = document.createElement("br");
        my_div.appendChild(linebreak);
        checkbox.appendChild(document.createTextNode(file_name));
        label.appendChild(document.createTextNode(file_name));
    }
  }
}

$(document).ready(function () {

    getAllNames({{Files|safe}},'{{Arguments['jars']}}', 1);
    showCoutureCheckBoxes(true);
    getAllNames({{Py_Files|safe}},'{{Arguments['py-files']}}', 2);
    pyShowCoutureCheckBoxes(true);
    getAllNames({{kt_Files|safe}},'{{Arguments['keytab']}}', 3);
    ktShowCoutureCheckBoxes(true);

  }
);




</script>
{% endblock %}